<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•2</title>
    <style>
        :root {
            --bg-primary: #f5f5f5;
            --bg-gradient: radial-gradient(circle at 10% 20%, rgba(255,221,225,0.3) 0%, rgba(204,235,255,0.3) 90%);
            --text-color: #333;
            --control-bg: rgba(255,255,255,0.8);
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.5s ease;
        }

        :root.dark-mode {
            --bg-primary: #1a1a2e;
            --bg-gradient: radial-gradient(circle at 10% 20%, rgba(60,40,80,0.3) 0%, rgba(30,50,80,0.3) 90%);
            --text-color: #eee;
            --control-bg: rgba(30,30,50,0.8);
            --shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: var(--bg-primary);
            height: 100vh;
            width: 100vw;
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            background-image: var(--bg-gradient);
            transition: all 0.5s ease;
        }

        /* æ°”æ³¡æ ·å¼ */
        .warm-tip-window {
            position: absolute;
            width: 250px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid transparent;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            font-size: 16px;
            font-weight: bold;
            color: var(--text-color);
            z-index: 1000;
            user-select: none;
            cursor: move;
            animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            padding: 0 15px;
            text-align: center;
            word-break: break-all;
        }

        .warm-tip-window::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 12px;
            background: linear-gradient(45deg, var(--border-color1), var(--border-color2));
            z-index: -1;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .warm-tip-window:hover {
            transform: scale(1.1) rotate(1deg);
            z-index: 1001;
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
            border-color: rgba(255,255,255,0.8);
        }

        .warm-tip-window:hover::before {
            opacity: 1;
        }

        .warm-tip-window.active {
            width: 320px;
            height: 80px;
            font-size: 20px;
            transform: scale(1.15) rotate(2deg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: bounce 0.5s ease;
        }

        /* æ°”æ³¡æ ‡ç­¾ */
        .tip-tag {
            position: absolute;
            top: -8px;
            right: 15px;
            background: rgba(255,255,255,0.9);
            color: #666;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .dark-mode .tip-tag {
            background: rgba(60,60,90,0.9);
            color: #ccc;
        }

        /* æ–‡å­—æ•ˆæœ */
        .text-flicker {
            animation: flicker 3s ease-in-out infinite;
        }

        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(45deg, var(--text-color), rgba(100,100,100,0.7));
        }

        /* ç²’å­å’Œè£…é¥°å…ƒç´  */
        .particle, .decor-icon {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 999;
        }

        .decor-icon {
            font-size: 16px;
            opacity: 0.7;
            animation: float 8s ease-in-out infinite;
        }

        /* å½©è™¹è½¨è¿¹ */
        .rainbow-trail {
            position: absolute;
            pointer-events: none;
            z-index: 998;
            height: 8px;
            width: 8px;
            border-radius: 50%;
            opacity: 0.8;
            animation: fadeOut 1s forwards;
        }

        /* éŸ³ä¹æ’­æ”¾å™¨ */
        .music-player {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--control-bg);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
            z-index: 3000;
            backdrop-filter: blur(3px);
        }

        .music-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(45deg, #8ec5fc, #e0c3fc);
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .dark-mode .music-btn {
            background: linear-gradient(45deg, #4a6fa5, #6b5ca5);
        }

        .music-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }

        .music-info {
            font-size: 13px;
            color: var(--text-color);
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* æ—¶é’Ÿç»„ä»¶ */
        .clock {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--control-bg);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: var(--text-color);
            box-shadow: var(--shadow);
            z-index: 3000;
            backdrop-filter: blur(3px);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .clock-time {
            font-size: 18px;
            font-weight: bold;
        }

        .clock-date {
            font-size: 12px;
            opacity: 0.8;
        }

        /* åº•éƒ¨æ§åˆ¶åŒº */
        .control-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--control-bg);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            color: var(--text-color);
            box-shadow: var(--shadow);
            z-index: 3000;
            backdrop-filter: blur(3px);
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .counter {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn {
            background: linear-gradient(45deg, #8ec5fc, #e0c3fc);
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .dark-mode .btn {
            background: linear-gradient(45deg, #4a6fa5, #6b5ca5);
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .btn.clear {
            background: linear-gradient(45deg, #ff9aa2, #ffb7b2);
        }

        .dark-mode .btn.clear {
            background: linear-gradient(45deg, #a54a52, #a56b72);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            background: rgba(0,0,0,0.1);
        }

        /* å³é”®èœå• */
        .context-menu {
            position: absolute;
            width: 120px;
            background: var(--control-bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 5000;
            display: none;
            backdrop-filter: blur(5px);
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s ease;
            font-size: 14px;
            color: var(--text-color);
        }

        .context-menu-item:hover {
            background: rgba(230,230,255,0.7);
        }

        .dark-mode .context-menu-item:hover {
            background: rgba(60,60,90,0.7);
        }

        .context-menu-item:first-child {
            border-radius: 8px 8px 0 0;
        }

        .context-menu-item:last-child {
            border-radius: 0 0 8px 8px;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes popIn {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            70% { transform: scale(1.1) rotate(5deg); opacity: 0.9; }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
            50% { box-shadow: 0 6px 20px rgba(0,0,0,0.25); }
            100% { box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
            70% { opacity: 1.1; }
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1.15) rotate(2deg); }
            50% { transform: scale(1.2) rotate(-1deg); }
        }

        @keyframes drift {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(10px, -5px) rotate(1deg); }
            50% { transform: translate(0, 10px) rotate(0deg); }
            75% { transform: translate(-10px, -5px) rotate(-1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        @keyframes fadeOut {
            0% { opacity: 0.8; transform: scale(1); }
            100% { opacity: 0; transform: scale(2); }
        }
    </style>
    <!-- å¼•å…¥å›¾æ ‡åº“ï¼ˆç”¨äºè£…é¥°å…ƒç´ å’ŒæŒ‰é’®ï¼‰ -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- éŸ³ä¹æ’­æ”¾å™¨ -->
    <div class="music-player">
        <button class="music-btn" id="musicBtn">
            <i class="fas fa-play"></i>
        </button>
        <div class="music-info">è½»æ¾èƒŒæ™¯éŸ³ä¹</div>
    </div>

    <!-- æ—¶é’Ÿç»„ä»¶ -->
    <div class="clock">
        <div class="clock-time" id="clockTime">00:00:00</div>
        <div class="clock-date" id="clockDate">2025-01-01</div>
    </div>

    <!-- åº•éƒ¨æ§åˆ¶åŒº -->
    <div class="control-panel">
        <div class="counter">æ°”æ³¡ï¼š<span id="tipCount">0</span> ä¸ª</div>
        <button class="btn add" id="addBtn">æ–°å¢æ°”æ³¡</button>
        <button class="btn clear" id="clearBtn">æ¸…ç©ºæ‰€æœ‰</button>
        <button class="theme-toggle" id="themeToggle" title="åˆ‡æ¢ä¸»é¢˜">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <!-- å³é”®èœå• -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" data-action="copy">å¤åˆ¶æ–‡å­—</div>
        <div class="context-menu-item" data-action="top">ç½®é¡¶çª—å£</div>
        <div class="context-menu-item" data-action="random">éšæœºä½ç½®</div>
        <div class="context-menu-item" data-action="close">å…³é—­æ°”æ³¡</div>
    </div>

    <script>
        // 1. åŸºç¡€é…ç½®
        const wordLib = {
            prefix: ['æ‚„æ‚„è¯´', 'è®°å¾—', 'ä¸€å®šè¦', 'æ„¿ä½ ', 'å¸Œæœ›ä½ ', 'åˆ«å¿˜äº†', 'å·å·å‘Šè¯‰ä½ ', 'å…¶å®', 'æ­¤åˆ»', 'å¿½ç„¶è§‰å¾—'],
            action: ['å¥½å¥½åƒé¥­', 'è®¤çœŸä¼‘æ¯', 'ä¿æŒå¿«ä¹', 'äº«å—æ—¶å…‰', 'å–„å¾…è‡ªå·±', 'åšæŒçƒ­çˆ±', 'æ‹¥æŠ±ç”Ÿæ´»', 'æ”¾æ…¢è„šæ­¥', 'ç§¯æ”’ç¾å¥½', 'ä¼ é€’æ¸©æš–'],
            emotion: ['ç”œç”œçš„', 'æš–æš–çš„', 'å…ƒæ°”æ»¡æ»¡çš„', 'æ¸©æŸ”çš„', 'åšå®šçš„', 'è½»æ¾çš„', 'æ²»æ„ˆçš„', 'å®‰å¿ƒçš„', 'é›€è·ƒçš„', 'ä»å®¹çš„'],
            result: ['ä¸‡äº‹é¡ºæ„', 'å¥½è¿å¸¸åœ¨', 'ç¬‘å®¹å¸¸åœ¨', 'è¢«çˆ±åŒ…å›´', 'æ”¶è·æƒŠå–œ', 'å¹³å®‰å–œä¹', 'å¿ƒæƒ³äº‹æˆ', 'æ—¥æ—¥é¡ºå¿ƒ', 'çƒ¦æ¼æ¶ˆæ•£', 'å¹¸ç¦æ„Ÿæ»¡æº¢'],
            scene: ['å¤©å‡‰æ·»è¡£', 'å¤©çƒ­å¤šå–æ°´', 'é˜´é›¨å¤©å¸¦ä¼', 'ç†¬å¤œä¼¤èº«ä½“', 'ç©ºè…¹åˆ«å–å’–å•¡', 'ä¹…åè®°å¾—æ‹‰ä¼¸', 'ç´¯äº†å°±æ­‡ä¼šå„¿', 'ç¡å‰åˆ«ç©æ‰‹æœº'],
            encourage: ['ä½ çœŸçš„å¾ˆæ£’', 'å†åšæŒä¸€ä¸‹', 'ä½ æ¯”æƒ³è±¡ä¸­å‰å®³', 'ä¸è¦è½»æ˜“æ”¾å¼ƒ', 'ä½ å€¼å¾—æ‰€æœ‰ç¾å¥½', 'ç»§ç»­é—ªé—ªå‘å…‰', 'ä½ çš„åŠªåŠ›ä¼šæœ‰å›æŠ¥'],
            suffix: ['å‘€ï½', 'å“¦ï½', 'å‘¢', 'å‘€', 'å“¦', 'å‘€ï¼', 'å“¦ï¼', 'å‘¢ï½']
        };

        const textTemplates = [
            '{prefix}ï¼Œ{action}{suffix}',
            '{emotion}{action}ï¼Œ{result}{suffix}',
            '{scene}ï¼Œ{emotion}è¿‡ä¸€å¤©{suffix}',
            '{encourage}ï¼Œ{action}å°±å¥½{suffix}',
            '{prefix}ï¼Œ{emotion}ä½ æœ€å¯çˆ±{suffix}',
            '{action}ï¼Œ{result}å‘€ï½',
            '{prefix}ï¼Œ{scene}ï¼Œåˆ«å¤§æ„{suffix}',
            '{emotion}æ—¶å…‰é‡Œï¼Œ{result}{suffix}',
            '{encourage}ï¼Œæœªæ¥å¯æœŸ{suffix}',
            '{prefix}ï¼Œ{result}ï¼Œå› ä¸ºæœ‰ä½ {suffix}'
        ];

        // æ°”æ³¡æ ‡ç­¾åº“
        const tipTags = ['æ²»æ„ˆ', 'æé†’', 'é¼“åŠ±', 'ç¾å¥½', 'æ¸©æš–', 'å¹¸è¿', 'æ—¥å¸¸', 'ç¥ç¦'];

        // è£…é¥°å›¾æ ‡åº“ï¼ˆFont Awesomeå›¾æ ‡ï¼‰
        const decorIcons = ['â¤ï¸', 'â­', 'â˜ï¸', 'ğŸŒ¸', 'âœ¨', 'ğŸ’–', 'ğŸŒ™', 'ğŸŒ¿', 'ğŸ’«', 'â˜€ï¸'];

        // é¢œè‰²åº“
        const bgColors = [
            'rgba(255, 221, 225, 0.85)', 'rgba(191, 239, 255, 0.85)', 'rgba(204, 255, 204, 0.85)',
            'rgba(230, 230, 255, 0.85)', 'rgba(255, 255, 204, 0.85)', 'rgba(255, 218, 225, 0.85)'
        ];

        const borderColorPairs = [
            ['#ff9aa2', '#ffb7b2'], ['#8ec5fc', '#e0c3fc'], ['#a8edea', '#fed6e3'],
            ['#ffd1ff', '#fa8bff'], ['#f9f586', '#f8d886'], ['#caffbf', '#9bf6ff']
        ];

        const particleColors = [
            'rgba(255, 154, 162, 0.7)', 'rgba(142, 197, 252, 0.7)', 'rgba(168, 237, 234, 0.7)'
        ];

        // å½©è™¹è‰²æ•°ç»„
        const rainbowColors = [
            'rgba(255,0,0,0.7)', 'rgba(255,165,0,0.7)', 'rgba(255,255,0,0.7)',
            'rgba(0,255,0,0.7)', 'rgba(0,0,255,0.7)', 'rgba(75,0,130,0.7)',
            'rgba(238,130,238,0.7)'
        ];

        // 2. å…¨å±€å˜é‡
        let tipCount = 0;
        const tipCountElement = document.getElementById('tipCount');
        const contextMenu = document.getElementById('contextMenu');
        const musicBtn = document.getElementById('musicBtn');
        const themeToggle = document.getElementById('themeToggle');
        const clockTime = document.getElementById('clockTime');
        const clockDate = document.getElementById('clockDate');
        let currentWindow = null;
        let audio = null;
        let isDarkMode = false;

        // 3. å·¥å…·å‡½æ•°
        // ç”Ÿæˆéšæœºæ–‡å­—
        function generateRandomText() {
            const template = textTemplates[Math.floor(Math.random() * textTemplates.length)];
            return template.replace(/{(\w+)}/g, (match, key) => {
                const words = wordLib[key];
                return words[Math.floor(Math.random() * words.length)];
            });
        }

        // éšæœºè·å–é¢œè‰²å¯¹
        function getRandomColorPair() {
            const pair = borderColorPairs[Math.floor(Math.random() * borderColorPairs.length)];
            const bgColor = bgColors[Math.floor(Math.random() * bgColors.length)];
            return { bgColor, border1: pair[0], border2: pair[1] };
        }

        // 4. æ–°å¢åŠŸèƒ½å®ç°
        // 4.1 éŸ³ä¹æ’­æ”¾å™¨
        function initMusicPlayer() {
            // åˆ›å»ºéŸ³é¢‘å…ƒç´ ï¼ˆä½¿ç”¨å…è´¹å…¬å…±éŸ³ä¹ï¼‰
            audio = new Audio('https://cdn.pixabay.com/download/audio/2022/01/18/audio_7f0d99a06f.mp3?filename=gentle-piano-113910.mp3');
            audio.loop = true;
            audio.volume = 0.3;

            musicBtn.addEventListener('click', function() {
                if (audio.paused) {
                    audio.play().catch(err => console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', err));
                    musicBtn.innerHTML = '<i class="fas fa-pause"></i>';
                } else {
                    audio.pause();
                    musicBtn.innerHTML = '<i class="fas fa-play"></i>';
                }
            });
        }

        // 4.2 æ—¶é’ŸåŠŸèƒ½
        function updateClock() {
            const now = new Date();
            // æ—¶é—´æ ¼å¼åŒ–ï¼šHH:MM:SS
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            clockTime.textContent = `${hours}:${minutes}:${seconds}`;

            // æ—¥æœŸæ ¼å¼åŒ–ï¼šYYYY-MM-DD æ˜ŸæœŸX
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const weekDay = weekDays[now.getDay()];
            clockDate.textContent = `${year}-${month}-${day} å‘¨${weekDay}`;
        }

        // 4.3 ä¸»é¢˜åˆ‡æ¢
        function initThemeToggle() {
            themeToggle.addEventListener('click', function() {
                isDarkMode = !isDarkMode;
                document.documentElement.classList.toggle('dark-mode', isDarkMode);
                // åˆ‡æ¢å›¾æ ‡
                if (isDarkMode) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                }
            });
        }

        // 4.4 éšæœºè£…é¥°å›¾æ ‡
        function createDecorIcon() {
            const icon = document.createElement('div');
            icon.className = 'decor-icon';
            icon.textContent = decorIcons[Math.floor(Math.random() * decorIcons.length)];

            // éšæœºä½ç½®å’Œå¤§å°
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const size = 12 + Math.random() * 8;

            icon.style.left = Math.random() * screenWidth + 'px';
            icon.style.top = Math.random() * screenHeight + 'px';
            icon.style.fontSize = size + 'px';
            icon.style.animationDuration = 5 + Math.random() * 10 + 's';

            document.body.appendChild(icon);

            // å®šæ—¶ç§»é™¤ï¼ˆé¿å…å†…å­˜å ç”¨ï¼‰
            setTimeout(() => {
                icon.style.opacity = '0';
                setTimeout(() => icon.remove(), 1000);
            }, 15000 + Math.random() * 10000);
        }

        // 4.5 å½©è™¹è½¨è¿¹
        function createRainbowTrail(x, y) {
            const trail = document.createElement('div');
            trail.className = 'rainbow-trail';
            trail.style.backgroundColor = rainbowColors[Math.floor(Math.random() * rainbowColors.length)];
            trail.style.left = x + 'px';
            trail.style.top = y + 'px';

            document.body.appendChild(trail);

            // è‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                trail.remove();
            }, 1000);
        }

        // 5. æ°”æ³¡æ ¸å¿ƒåŠŸèƒ½
        function showWarmTip() {
            const tipWindow = document.createElement('div');
            tipWindow.className = 'warm-tip-window text-gradient';
            
            // ç”Ÿæˆå†…å®¹å’Œæ ·å¼
            const text = generateRandomText();
            const { bgColor, border1, border2 } = getRandomColorPair();
            const tag = tipTags[Math.floor(Math.random() * tipTags.length)];
            
            tipWindow.innerText = text;
            tipWindow.style.backgroundColor = bgColor;
            tipWindow.style.setProperty('--border-color1', border1);
            tipWindow.style.setProperty('--border-color2', border2);

            // æ·»åŠ æ ‡ç­¾
            const tagElement = document.createElement('div');
            tagElement.className = 'tip-tag';
            tagElement.innerText = tag;
            tipWindow.appendChild(tagElement);

            // éšæœºä½ç½®
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const winWidth = 250;
            const winHeight = 60;

            const x = 20 + Math.random() * (screenWidth - winWidth - 40);
            const y = 20 + Math.random() * (screenHeight - winHeight - 40);

            tipWindow.style.left = x + 'px';
            tipWindow.style.top = y + 'px';

            // éšæœºåŠ¨ç”»
            const animType = Math.random();
            if (animType > 0.6) {
                tipWindow.style.animation = 'float 8s ease-in-out infinite';
            } else if (animType > 0.3) {
                tipWindow.style.animation = 'pulse 4s ease-in-out infinite';
            } else {
                tipWindow.style.animation = 'drift 12s ease-in-out infinite';
            }

            // æ–‡å­—é—ªçƒæ•ˆæœ
            if (Math.random() < 0.2) {
                tipWindow.classList.add('text-flicker');
            }

            // ç¢°æ’æ£€æµ‹é€Ÿåº¦
            tipWindow.dataset.speedX = (Math.random() - 0.5) * 0.5;
            tipWindow.dataset.speedY = (Math.random() - 0.5) * 0.5;

            // æ‹–æ‹½åŠŸèƒ½
            makeDraggable(tipWindow);

            // å·¦é”®ç‚¹å‡»ï¼šå˜è‰²+ç²’å­
            tipWindow.onclick = function(e) {
                e.stopPropagation();
                const { bgColor: newBg, border1: newBorder1, border2: newBorder2 } = getRandomColorPair();
                this.style.backgroundColor = newBg;
                this.style.setProperty('--border-color1', newBorder1);
                this.style.setProperty('--border-color2', newBorder2);
                createParticles(e.clientX, e.clientY);
            };

            // åŒå‡»æ”¾å¤§
            tipWindow.ondblclick = function(e) {
                e.stopPropagation();
                this.classList.toggle('active');
                if (this.classList.contains('active')) {
                    this.innerText = generateRandomText();
                    // é‡æ–°æ·»åŠ æ ‡ç­¾
                    const newTag = tipTags[Math.floor(Math.random() * tipTags.length)];
                    this.querySelector('.tip-tag').innerText = newTag;
                } else {
                    this.innerText = generateRandomText();
                    const newTag = tipTags[Math.floor(Math.random() * tipTags.length)];
                    this.querySelector('.tip-tag').innerText = newTag;
                }
            };

            // å³é”®èœå•
            tipWindow.oncontextmenu = function(e) {
                e.preventDefault();
                currentWindow = this;
                contextMenu.style.display = 'block';
                contextMenu.style.left = e.clientX + 'px';
                contextMenu.style.top = e.clientY + 'px';
            };

            // é¿å…é‡å 
            avoidOverlap(tipWindow);

            document.body.appendChild(tipWindow);
            tipCount++;
            updateTipCount();

            // è‡ªåŠ¨ç§»åŠ¨
            startAutoMove(tipWindow);
        }

        // æ‹–æ‹½åŠŸèƒ½
        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            element.onmousedown = dragStart;

            function dragStart(e) {
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.zIndex = 2000;
                document.onmousemove = dragMove;
                document.onmouseup = dragEnd;
            }

            function dragMove(e) {
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;

                const newLeft = element.offsetLeft - pos1;
                const newTop = element.offsetTop - pos2;
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                const winWidth = element.offsetWidth;
                const winHeight = element.offsetHeight;

                if (newLeft >= 0 && newLeft <= screenWidth - winWidth) {
                    element.style.left = newLeft + "px";
                }
                if (newTop >= 0 && newTop <= screenHeight - winHeight) {
                    element.style.top = newTop + "px";
                }
            }

            function dragEnd() {
                element.style.zIndex = 1000;
                document.onmousemove = null;
                document.onmouseup = null;
            }
        }

        // è‡ªåŠ¨ç§»åŠ¨å’Œç¢°æ’
        function startAutoMove(element) {
            function move() {
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                const winWidth = element.offsetWidth;
                const winHeight = element.offsetHeight;

                let x = parseInt(element.style.left) || 0;
                let y = parseInt(element.style.top) || 0;
                let speedX = parseFloat(element.dataset.speedX);
                let speedY = parseFloat(element.dataset.speedY);

                // è¾¹ç•Œç¢°æ’
                if (x <= 0 || x >= screenWidth - winWidth) {
                    speedX = -speedX;
                    element.dataset.speedX = speedX;
                }
                if (y <= 0 || y >= screenHeight - winHeight) {
                    speedY = -speedY;
                    element.dataset.speedY = speedY;
                }

                x += speedX;
                y += speedY;

                element.style.left = x + 'px';
                element.style.top = y + 'px';

                if (element.parentNode) {
                    requestAnimationFrame(move);
                }
            }

            move();
        }

        // é¿å…é‡å 
        function avoidOverlap(newWindow) {
            const allWindows = document.querySelectorAll('.warm-tip-window');
            if (allWindows.length <= 1) return;

            const newRect = newWindow.getBoundingClientRect();
            let overlap = false;

            allWindows.forEach(window => {
                if (window === newWindow) return;
                const rect = window.getBoundingClientRect();
                if (
                    newRect.left < rect.right &&
                    newRect.right > rect.left &&
                    newRect.top < rect.bottom &&
                    newRect.bottom > rect.top
                ) {
                    overlap = true;
                }
            });

            if (overlap) {
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                const winWidth = newWindow.offsetWidth;
                const winHeight = newWindow.offsetHeight;

                const newLeft = 20 + Math.random() * (screenWidth - winWidth - 40);
                const newTop = 20 + Math.random() * (screenHeight - winHeight - 40);

                newWindow.style.left = newLeft + 'px';
                newWindow.style.top = newTop + 'px';
            }
        }

        // ç²’å­æ•ˆæœ
        function createParticles(x, y) {
            const particleCount = 15;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';

                const size = 3 + Math.random() * 8;
                const color = particleColors[Math.floor(Math.random() * particleColors.length)];
                const angle = Math.random() * Math.PI * 2;
                const speed = 2 + Math.random() * 5;
                const distance = 5 + Math.random() * 20;

                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.backgroundColor = color;
                particle.style.left = x - size/2 + 'px';
                particle.style.top = y - size/2 + 'px';

                let startTime = Date.now();
                const duration = 800 + Math.random() * 500;

                function updateParticle() {
                    const elapsed = Date.now() - startTime;
                    if (elapsed > duration) {
                        particle.remove();
                        return;
                    }

                    const progress = elapsed / duration;
                    const currentDistance = distance * progress;
                    const newX = x - size/2 + Math.cos(angle) * currentDistance;
                    const newY = y - size/2 + Math.sin(angle) * currentDistance;

                    particle.style.left = newX + 'px';
                    particle.style.top = newY + 'px';
                    particle.style.opacity = 1 - progress;

                    requestAnimationFrame(updateParticle);
                }

                document.body.appendChild(particle);
                requestAnimationFrame(updateParticle);
            }
        }

        // æ›´æ–°è®¡æ•°
        function updateTipCount() {
            tipCountElement.innerText = tipCount;
        }

        // å³é”®èœå•äº‹ä»¶
        contextMenu.addEventListener('click', function(e) {
            const action = e.target.dataset.action;
            if (!currentWindow) return;

            switch(action) {
                case 'copy':
                    navigator.clipboard.writeText(currentWindow.innerText)
                        .then(() => {
                            const originalText = currentWindow.innerText;
                            currentWindow.innerText = 'å¤åˆ¶æˆåŠŸï¼';
                            setTimeout(() => {
                                currentWindow.innerText = originalText;
                            }, 1000);
                        });
                    break;
                case 'top':
                    currentWindow.style.zIndex = 3000;
                    break;
                case 'random':
                    const screenWidth = window.innerWidth;
                    const screenHeight = window.innerHeight;
                    const winWidth = currentWindow.offsetWidth;
                    const winHeight = currentWindow.offsetHeight;

                    const x = 20 + Math.random() * (screenWidth - winWidth - 40);
                    const y = 20 + Math.random() * (screenHeight - winHeight - 40);

                    currentWindow.style.left = x + 'px';
                    currentWindow.style.top = y + 'px';
                    break;
                case 'close':
                    createParticles(
                        parseInt(currentWindow.style.left) + currentWindow.offsetWidth/2,
                        parseInt(currentWindow.style.top) + currentWindow.offsetHeight/2
                    );
                    currentWindow.style.opacity = "0";
                    currentWindow.style.transform = "scale(0.8)";
                    setTimeout(() => {
                        if (currentWindow.parentNode) {
                            currentWindow.parentNode.removeChild(currentWindow);
                            tipCount--;
                            updateTipCount();
                        }
                    }, 300);
                    break;
            }

            contextMenu.style.display = 'none';
            currentWindow = null;
        });

        // ç‚¹å‡»ç©ºç™½å¤„å…³é—­èœå•+æ·»åŠ æ°”æ³¡+å½©è™¹è½¨è¿¹
        document.addEventListener('click', function(e) {
            contextMenu.style.display = 'none';
            currentWindow = null;

            if (e.target === document.body) {
                showWarmTip();
                createRainbowTrail(e.clientX, e.clientY);
            }
        });

        // é¼ æ ‡ç§»åŠ¨æ—¶ç”Ÿæˆå°‘é‡å½©è™¹è½¨è¿¹ï¼ˆå¯é€‰ï¼‰
        document.addEventListener('mousemove', function(e) {
            if (Math.random() < 0.1) { // 10%æ¦‚ç‡ç”Ÿæˆï¼Œé¿å…è¿‡å¤š
                createRainbowTrail(e.clientX, e.clientY);
            }
        });

        // æŒ‰é’®äº‹ä»¶
        document.getElementById('addBtn').addEventListener('click', function(e) {
            e.stopPropagation();
            showWarmTip();
        });

        document.getElementById('clearBtn').addEventListener('click', function(e) {
            e.stopPropagation();
            const allWindows = document.querySelectorAll('.warm-tip-window');
            allWindows.forEach(window => {
                createParticles(
                    parseInt(window.style.left) + window.offsetWidth/2,
                    parseInt(window.style.top) + window.offsetHeight/2
                );
                window.style.opacity = "0";
                window.style.transform = "scale(0.8)";
                setTimeout(() => {
                    if (window.parentNode) {
                        window.parentNode.removeChild(window);
                    }
                }, 300);
            });
            tipCount = 0;
            updateTipCount();
        });

        // 6. åˆå§‹åŒ–åŠŸèƒ½
        function init() {
            // åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨
            initMusicPlayer();
            
            // åˆå§‹åŒ–æ—¶é’Ÿ
            updateClock();
            setInterval(updateClock, 1000);
            
            // åˆå§‹åŒ–ä¸»é¢˜åˆ‡æ¢
            initThemeToggle();
            
            // å®šæ—¶ç”Ÿæˆè£…é¥°å›¾æ ‡
            setInterval(createDecorIcon, 3000);
            
            // åˆå§‹åˆ›å»º30ä¸ªæ°”æ³¡
            const totalWindows = 30;
            const intervalDelay = 150;

            for (let i = 0; i < totalWindows; i++) {
                setTimeout(() => {
                    showWarmTip();
                }, i * intervalDelay);
            }

            // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´ä½ç½®
            window.onresize = function() {
                const allWindows = document.querySelectorAll('.warm-tip-window');
                allWindows.forEach(window => {
                    const rect = window.getBoundingClientRect();
                    const screenWidth = window.innerWidth;
                    const screenHeight = window.innerHeight;
                    const winWidth = window.offsetWidth;
                    const winHeight = window.offsetHeight;

                    let newLeft = rect.left;
                    let newTop = rect.top;

                    if (newLeft < 0) newLeft = 20;
                    if (newLeft > screenWidth - winWidth) newLeft = screenWidth - winWidth - 20;
                    if (newTop < 0) newTop = 20;
                    if (newTop > screenHeight - winHeight) newTop = screenHeight - winHeight - 20;

                    window.style.left = newLeft + 'px';
                    window.style.top = newTop + 'px';
                });
            };
        }

        // å¯åŠ¨åº”ç”¨
        window.addEventListener('load', init);
    </script>
</body>
</html>